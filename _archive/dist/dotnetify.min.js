var dotnetify="undefined"==typeof dotnetify?{}:dotnetify,dotNetify={};!function(a){"function"==typeof define&&define.amd?define(["jquery","knockout","ko-mapping","dotnetify-hub","jquery-ui"],a):"object"==typeof exports&&"object"==typeof module?module.exports=a(require("jquery"),require("knockout"),require("ko-mapping"),require("jquery-ui"),require("./dotnetify-hub")):a(jQuery,ko,ko.mapping,dotnetifyHub)}(function(a,b,c,d){return b.mapping=c,dotnetify=a.extend(dotnetify,{version:"1.2.0",hub:d,hubLib:null,hubOptions:{transport:["webSockets","longPolling"]},hubPath:null,hubServerUrl:null,debug:!1,debugFn:null,offline:!1,isOffline:!0,offlineTimeout:5e3,offlineCacheFn:null,_hub:null,init:function(){var b=function(){a.each(a("[data-vm]"),function(){a(this).dotnetify()})};if(null===dotnetify._hub){d.init(dotnetify.hubPath,dotnetify.hubServerUrl,dotnetify.hubLib),d.client.response_VM=function(b,c){if(Array.isArray(b)&&(c=b[1],b=b[0]),"403"==c)return void console.error("Unauthorized access to "+b);var e=b,f=null;if(e.indexOf("$")>=0){var g=b.split("$");e=g[0],f=g[1]}var h="[data-vm='"+e+"']",g=e.split(".");if(g.length>1){for(h="",i=0;i<g.length-1;i++)h+="[data-master-vm='"+g[i]+"'] ";h+="[data-vm='"+g[i]+"']"}null!=f&&(h+="[data-vm-id='"+f+"']");var j=a(h);j.length>0?j.data("ko-dotnetify").UpdateVM(c):d.server.dispose_VM(b)};var c=function(){var c=d.start(dotnetify.hubOptions).done(function(){dotnetify._connectRetry=0,b()}).fail(function(a){console.error(a)});return setTimeout(function(){dotnetify.offline&&!dotnetify.isConnected()&&(b(),dotnetify.isOffline=!0,a(document).trigger("offline",dotnetify.isOffline))},dotnetify.offlineTimeout),c};dotnetify._hub=c(),d.disconnected(function(){setTimeout(function(){dotnetify._hub=c()},5e3*dotnetify._connectRetry+500),dotnetify._connectRetry<3&&dotnetify._connectRetry++}),d.stateChanged(function(b){console.log("SignalR: "+b);var c="connected"!=b;dotnetify.isOffline!=c&&(dotnetify.isOffline=c,a(document).trigger("offline",dotnetify.isOffline))})}else dotnetify.isConnected()?dotnetify._hub.done(b):dotnetify.offline&&b()},isConnected:function(){return d.isConnected},widget:function(b){return a(b).data("ko-dotnetify")},plugins:{},_connectRetry:0}),dotNetify=dotnetify,a(function(){dotnetify.init()}),a.widget("ko.dotnetify",{_create:function(){var b=this;b.VMType=b.element.attr("data-vm"),b.VMId=b.VMType,b.Hub=d;var c=b.element.attr("data-vm-id");null!=c&&(b.VMId+="$"+c),a.each(b.element.parents("[data-master-vm]"),function(){b.VMId=a(this).attr("data-master-vm")+"."+b.VMId}),dotnetify.offline&&b._ListenToOfflineEvent(),null!=b.VMId?dotnetify.isConnected()?b._RequestVM():dotnetify.offline&&b._GetOfflineVM():console.error("ERROR: dotnetify - failed to find 'data-vm' attribute in the element where .dotnetify() was applied.")},_destroy:function(){try{var b=this;"function"==typeof b.OfflineFn&&a(document).off("offline",b.OfflineFn),a.each(dotnetify.plugins,function(a,c){"function"==typeof c.$destroy&&c.$destroy.apply(b.VM)}),null!=b.VM&&b.VM.hasOwnProperty("$destroy")&&b.VM.$destroy()}catch(a){console.error(a.stack)}this.Hub.server.dispose_VM(b.VMId)},UpdateVM:function(c){var d=this;try{if(null==d.VM){d.VM=b.mapping.fromJS(JSON.parse(c)),d.VM.$vmId=d.VMId,d.VM.$element=d.element,dotnetify.offline&&(d.VM.$vmOffline=b.observable(d.IsOffline)),this._AddBuiltInFunctions(),a.each(dotnetify.plugins,function(a,b){"function"==typeof b.$init&&b.$init.apply(d.VM)}),"function"==typeof d.VM.$init&&d.VM.$init();try{b.applyBindings(d.VM,d.element[0])}catch(a){console.error(a.stack)}d.VM.$serverUpdate=!0,d._OnComponentReady(function(){a.each(dotnetify.plugins,function(a,b){"function"==typeof b.$ready&&b.$ready.apply(d.VM)}),d._SubscribeObservables(d.VM),"function"==typeof d.VM.$ready&&d.VM.$ready(),d.element.trigger("ready",{VMId:d.VMId,VM:d.VM})}),dotnetify.offline&&dotnetify.isConnected()&&"function"==typeof dotnetify.offlineCacheFn&&dotnetify.offlineCacheFn(d.VMId+d.element.attr("data-vm-arg"),c)}else{d.VM.$serverUpdate=!1;var e=JSON.parse(c);d._PreProcess(e);try{b.mapping.fromJS(e,d.VM)}catch(a){console.error(a.stack)}d.VM.$serverUpdate=!0,d._OnComponentReady(function(){d._SubscribeObservables(d.VM)})}}catch(a){console.error(a.stack)}dotnetify.debug&&(console.log("["+d.VMId+"] received> "),console.log(JSON.parse(c)),null!=dotnetify.debugFn&&dotnetify.debugFn(d.VMId,"received",JSON.parse(c)))},_AddBuiltInFunctions:function(){var c=this;c.VM.$preventBinding=function(a){c.VM.$serverUpdate=!1,a.apply(c.VM),c.VM.$serverUpdate=!0},c.VM.$addList=function(a,c){var d=b.mapping.fromJS(c),e=a().$vmKey;if(null!=e){var f=b.utils.arrayFirst(a(),function(a){return a[e]()==d[e]()});if(null!=f)return void a.replace(f,d)}a.push(d)},c.VM.$updateList=function(a,c){var d=b.mapping.fromJS(c),e=a().$vmKey;if(null!=e){if(!d.hasOwnProperty(e))return void console.error("ERROR: object requires property '"+e+"'");var f=b.utils.arrayFirst(a(),function(a){return a[e]()==d[e]()});if(null!=f){for(prop in d)b.isObservable(d[prop])&&f[prop](d[prop]());return}}a.push(d)},c.VM.$removeList=function(a,b){c.VM.$preventBinding(function(){a.remove(b)})},c.VM.$on=function(a,b){a.subscribe(function(a){b(a)})},c.VM.$once=function(a,b){var c=a.subscribe(function(a){c.dispose(),b(a)})},c.VM.$loadView=function(b,c,d,e,f){return"object"==typeof d&&null!=d?(f=e,e=d,d=null):"function"==typeof d?(f=d,d=null):"function"==typeof e&&(f=e,e=null),null==c||""==c?void a(b).empty():void a(b).load(c,null,function(){null==e||a.isEmptyObject(e)||a(this).attr("data-vm-arg",JSON.stringify(e)),"function"==typeof f&&f.apply(this),null!=d?a.getScript(d,function(){dotnetify.init()}):dotnetify.init()})},c.VM.$inject=function(d,e){b.isObservable(d)&&"push"in d?a.each(d(),function(a,b){c._Inject(b,e)}):c._Inject(d,e)};var d=window[c.VMType];null!=d&&("function"==typeof d&&(d=new d),c._Inject(c.VM,d)),a.each(dotnetify.plugins,function(a,b){b.hasOwnProperty("$inject")&&b.$inject(c.VM)})},_GetOfflineVM:function(){var a=this;if("function"==typeof dotnetify.offlineCacheFn){var b=dotnetify.offlineCacheFn(a.VMId+a.element.attr("data-vm-arg"));null==b&&(b=dotnetify.offlineCacheFn(a.VMId)),null!=b&&(dotnetify.debug&&console.warn("["+a.VMId+"] using offline data"),a.IsOffline=!0,a.UpdateVM(b))}},_ListenToOfflineEvent:function(){var b=this;b.IsOffline=!1,b.OfflineFn=function(c,d){null!=b.VM&&b.VM.hasOwnProperty("$vmOffline")&&b.VM.$vmOffline(d),b.IsOffline=d,d?null==b.VM&&b._GetOfflineVM():b._RequestVM(),a(document).one("offline",b.OfflineFn.bind(b))},a(document).one("offline",b.OfflineFn.bind(b))},_Inject:function(a,c){for(prop in c)a.hasOwnProperty(prop)||("function"==typeof c[prop]?0==prop.indexOf("_")?a[prop]=b.pureComputed(c[prop],a):a[prop]=c[prop]:0==prop.indexOf("_")&&(a[prop]=b.observable(c[prop]),a[prop].$subscribe=!0))},_OnComponentReady:function(b){var c=this,d=0,e=function(){var f=!0,g=c.element.find("[params]");g.length>0&&(f=0==a.grep(g,function(a){return 0==a.childElementCount}).length),f||d++>3?b():setTimeout(e,250)};e()},_OnValueChanged:function(b,c){var d={};if(d[b]=c instanceof Object?a.extend({},c):c,dotnetify.isConnected())try{this.Hub.server.update_VM(this.VMId,d),dotnetify.debug&&(console.log("["+this.VMId+"] sent> "),console.log(d),null!=dotnetify.debugFn&&dotnetify.debugFn(this.VMId,"sent",d))}catch(a){console.error(a)}},_PreProcess:function(a){for(var b in a){var c=/(.*)_add/.exec(b);if(null==c){var c=/(.*)_update/.exec(b);if(null==c){var c=/(.*)_remove/.exec(b);if(null==c);else{var d=this.VM[c[1]];if(null==d)throw new Error("unable to resolve "+b);var e=d().$vmKey;if(null==e)throw new Error("unable to resolve "+b+" due to missing vmItemKey attribute");this.VM.$removeList(this.VM[c[1]],function(c){return c[e]()==a[b]}),delete a[b]}}else{var d=this.VM[c[1]];if(null==d)throw new Error("unable to resolve "+b);this.VM.$updateList(d,a[b]),delete a[b]}}else{var d=this.VM[c[1]];if(null==d)throw new Error("unable to resolve "+b);this.VM.$addList(d,a[b]),delete a[b]}}},_RequestVM:function(){var b=this,c=b.element.attr("data-vm-arg");if(c=null!=c?a.parseJSON(c.replace(/'/g,'"')):null,dotnetify.isConnected())try{b.Hub.server.request_VM(b.VMId,c)}catch(a){console.error(a)}},_SubscribeObservables:function(a,c){var d=this;if(null!=a)if(b.isObservable(a))"$subscribe"in a==!1&&(a.subscribe(function(a){d.VM.$serverUpdate===!0&&d._OnValueChanged(c,a)}),a.$subscribe=!0),this._SubscribeObservables(a(),c);else if("object"==typeof a){var e="$vmKey"in a?a.$vmKey:null;for(property in a)"$"!=property.charAt(0)&&"_"!=property.charAt(0)&&(path=null!=e?"$"+a[property][e]():property,this._SubscribeObservables(a[property],null==c?path:c+"."+path))}else if(a instanceof Array)for(index in a)path="$"+index,this._SubscribeObservables(a[index],null==c?path:c+"."+path)}}),b.bindingHandlers.vmItemKey={preprocess:function(a){return"'"!=a.charAt(0)?"'"+a+"'":a},update:function(a,c,d,e,f){var g=c(),h=d.get("foreach");!b.isObservable(h)&&h.hasOwnProperty("data")&&(h=h.data),b.isObservable(h)&&null!=h()&&null!=g&&(h().$vmKey=g)}},b.bindingHandlers.vmCommand={init:function(a,c,d,e,f){var g=f.$root,h=null,i=null,j=/return\s{(.*):(.*)}\s/.exec(c.toString());if(null!=j)h=j[1].trim(),i=j[2].trim();else{var k=/return\s(.*)\s/.exec(c.toString());null!=k&&(h=k[1].trim())}if(null==h)throw new Error("invalid vmCommand value at "+a.outerHTML);var l=function(){return null!=g[h]?g[h]:c()};null!=i?"'"==i.charAt(0)?i=i.replace(/(^'|'$)/g,""):b.isObservable(e[i])?i=b.unwrap(e[i]):"$data"==i&&(i=e):i=!0;var m=function(){return function(){var c=l();b.isObservable(c)?(g.$preventBinding(function(){c(i!==!0&&null)}),c(i)):c.apply(g,[e,a,f.$parent])}};b.bindingHandlers.click.init(a,m,d,e,f)}},b.bindingHandlers.vmOnce={init:function(a,c,d,e,f){b.bindingHandlers.vmOn.init(a,c,d,e,f,!0)}},b.bindingHandlers.vmOn={init:function(a,c,d,e,f,g){var h=f.$root,i=null,j=null,k=c.toString(),l=/return\s{(.*):(.*)}\s/.exec(k);if(null!=l&&(i=l[1].trim(),j=l[2].trim()),null==j)throw new Error("invalid vmOn function at "+a.outerHTML);var m=function(){return null!=h[j]?h[j]:c()[i]};if(null!=i&&!b.isObservable(e[i]))throw new Error("invalid vmOn data: "+c());m().apply(h,[e,a,f.$parent]),null==g&&e[i].subscribe(function(b){m().apply(h,[e,a,f.$parent])})}},dotnetify}),function(a){"function"==typeof define&&define.amd?define(["jquery","knockout","dotnetify"],a):"object"==typeof exports&&"object"==typeof module?module.exports=a(require("jquery"),require("knockout"),require("dotnetify")):a(jQuery,ko,dotnetify)}(function(a,b,c){var d={version:"0.8.4",map:function(a){return d.routes.defined.hasOwnProperty(a)?d.routes.defined[a]:new d.core.route(a)},root:function(a){d.routes.root=a},rescue:function(a){d.routes.rescue=a},history:{initial:{},pushState:function(a,b,c){d.history.supported?d.dispatch(c)&&history.pushState(a,b,c):d.history.fallback&&(window.location.hash="#"+c)},popState:function(a){var b=!d.history.initial.popped&&location.href==d.history.initial.URL;d.history.initial.popped=!0,b||d.dispatch(document.location.pathname)},listen:function(a){if(d.history.supported=!(!window.history||!window.history.pushState),d.history.fallback=a,d.history.supported)d.history.initial.popped="state"in window.history,d.history.initial.URL=location.href,window.onpopstate=d.history.popState;else if(d.history.fallback){for(route in d.routes.defined)"#"!=route.charAt(0)&&(d.routes.defined["#"+route]=d.routes.defined[route],d.routes.defined["#"+route].path="#"+route);d.listen()}}},match:function(a,b){var c,e,f,g,h,i={},j=null;for(j in d.routes.defined)if(null!==j&&void 0!==j)for(j=d.routes.defined[j],c=j.partition(),g=0;g<c.length;g++){if(e=c[g],h=a,e.search(/:/)>0)for(f=0;f<e.split("/").length;f++)f<h.split("/").length&&":"===e.split("/")[f].charAt(0)&&(i[e.split("/")[f].replace(/:/,"")]=h.split("/")[f],h=h.replace(h.split("/")[f],e.split("/")[f]));if(e===h)return b&&(j.params=i),j}return null},dispatch:function(a){var b,c;if(d.routes.current!==a){if(d.routes.previous=d.routes.current,d.routes.current=a,c=d.match(a,!0),d.routes.previous&&(b=d.match(d.routes.previous),null!==b&&null!==b.do_exit&&b.do_exit()),null!==c)return c.run(),!0;null!==d.routes.rescue&&d.routes.rescue()}},listen:function(){var a=function(){d.dispatch(location.hash)};""===location.hash&&null!==d.routes.root&&(location.hash=d.routes.root),"onhashchange"in window&&(!document.documentMode||document.documentMode>=8)?window.onhashchange=a:setInterval(a,50),""!==location.hash&&d.dispatch(location.hash)},core:{route:function(a){this.path=a,this.action=null,this.do_enter=[],this.do_exit=null,this.params={},d.routes.defined[a]=this}},routes:{current:null,root:null,rescue:null,previous:null,defined:{}}};d.core.route.prototype={to:function(a){return this.action=a,this},enter:function(a){return a instanceof Array?this.do_enter=this.do_enter.concat(a):this.do_enter.push(a),this},exit:function(a){return this.do_exit=a,this},partition:function(){for(var a,b,c=[],d=[],e=/\(([^}]+?)\)/g;a=e.exec(this.path);)c.push(a[1]);for(d.push(this.path.split("(")[0]),b=0;b<c.length;b++)d.push(d[d.length-1]+c[b]);return d},run:function(){var a,b,c=!1;if(d.routes.defined[this.path].hasOwnProperty("do_enter")&&d.routes.defined[this.path].do_enter.length>0)for(a=0;a<d.routes.defined[this.path].do_enter.length;a++)if(b=d.routes.defined[this.path].do_enter[a](),b===!1){c=!0;break}c||d.routes.defined[this.path].action()}},c.router={version:"1.2.0",urlPath:document.location.pathname,init:function(){if("undefined"==typeof d)throw new Error("Pathjs library is required for routing.");d.history.listen(!0),d.routes.rescue=function(){window.location.replace(document.location.pathname)}},mapTo:function(a,b){"undefined"!=typeof d&&d.map(a).to(function(){b(this.params)})},match:function(a){if("undefined"!=typeof d){var b=d.match(a,!0);if(null!=b)return b.run(),!0}return!1},overrideUrl:function(a){return a},pushState:function(a,b,e){c.router.urlPath="","undefined"!=typeof d&&d.history.pushState(a,b,e)},redirect:function(b){c.router.urlPath=b;var d=a("[data-vm]");for(j=0;j<d.length;j++){var e=c.widget(d[j]);if(null!=e&&e.VM.$router.routeUrl())return}window.location.replace(b)},$ready:function(){this.$router.initRouting()}},c.router.$inject=function(b){b.$router=function(b){var d=function(){return{trim:function(a){if("string"!=typeof a)return"";for(;a.indexOf("/",a.length-1)>=0;)a=a.substr(0,a.length-1);for(;0==a.indexOf("/");)a=a.substr(1,a.length-1);return a},equal:function(a,b){return null!=a&&null!=b&&a.toLowerCase()==b.toLowerCase()},startsWith:function(a,b){return a.toLowerCase().slice(0,b.length)==b.toLowerCase()},endsWith:function(a,b){return""==b||a.toLowerCase().slice(-b.length)==b.toLowerCase()}}}();return{initRoot:function(){var a=this;if(a.hasOwnProperty("RoutingState")&&"function"==typeof a.RoutingState.Root&&a.$router._absRoot!=a.RoutingState.Root()){var b=d.trim(a.$element.attr("data-vm-root"));""!=b&&(b="/"+b);var c=d.trim(a.RoutingState.Root());a.$router._absRoot=""!=c?b+"/"+c:b,a.RoutingState.Root(a.$router._absRoot)}}.bind(b),initRouting:function(){var b=this;if(b.hasOwnProperty("RoutingState")&&"function"==typeof b.RoutingState.Templates){var d=b.RoutingState.Templates();if(null!=d){c.router.$init||(c.router.init(),c.router.$init=!0),b.$router.initRoot(),a.each(d,function(a,d){var e=b.$router.toUrl(d.UrlPattern());c.debug&&console.log("router> map "+e+" to template id="+d.Id()),c.router.mapTo(e,function(a){c.router.urlPath="";var e=d.UrlPattern();for(param in a)e=e.replace(":"+param,a[param]);e=e.replace(/\(\/:([^)]+)\)/g,"").replace(/\(|\)/g,""),b.$router.routeTo(e,d)})});var e=b.$router.toUrl(b.RoutingState.Active());""==c.router.urlPath&&(c.router.urlPath=e),b.$router.routeUrl()}}}.bind(b),isActive:function(a){return!(null==a||!a.hasOwnProperty("Path")||"function"!=typeof a.Path)&&d.equal(a.Path(),this.RoutingState.Active())}.bind(b),loadView:function(b,e,f,g,h){var i=this;if(null==e||""==e)return void a(b).empty();var j=function(){i.hasOwnProperty("RoutingState")&&"function"==typeof i.RoutingState.Root&&a.each(a(this).find("[data-vm]"),function(b,c){var e=a(c).attr("data-vm-root");if(e=null!=e?"/"+d.trim(i.RoutingState.Root())+"/"+d.trim(e):i.RoutingState.Root(),a(c).attr("data-vm-root",e),null!=g&&!a.isEmptyObject(g)){var f=a(c).attr("data-vm-arg");f=null!=f?a.extend(g,a.parseJSON(f.replace(/'/g,'"'))):g,a(c).attr("data-vm-arg",JSON.stringify(f))}}),"function"==typeof h&&h.apply(this)};e=c.router.overrideUrl(e),i.$loadView(b,e,f,g,j)}.bind(b),manualRouteTo:function(a,b,c,d){var e={};e.Target=function(){return b},e.ViewUrl=function(){return c},e.JSModuleUrl=function(){return d},this.$router.routeTo(a,e,!0)}.bind(b),routeTo:function(b,e,f){var g=this;c.debug&&console.log("router> route '"+b+"' to template id="+e.Id());var h=a("#"+e.Target()+" [data-vm-arg]").attr("data-vm-arg");if(!(null!=h&&(h=a.parseJSON(h.replace(/'/g,'"')),"string"==typeof h["RoutingState.Origin"]&&d.equal(h["RoutingState.Origin"],b))||1!=f&&g.hasOwnProperty("onRouteEnter")&&0==g.onRouteEnter(b,e)))return 0==a("#"+e.Target()).length?c.router.redirect(g.$router.toUrl(b)):void g.$router.loadView("#"+e.Target(),e.ViewUrl(),e.JSModuleUrl(),{"RoutingState.Origin":b},function(){g.RoutingState.Active(b),1!=f&&g.hasOwnProperty("onRouteExit")&&g.onRouteExit(b,e)}.bind(g))}.bind(b),routeUrl:function(){var b=this;if(!b.hasOwnProperty("RoutingState")||"function"!=typeof b.RoutingState.Templates)return!1;var e=b.RoutingState.Root();if(null==e)return!1;var f=c.router.urlPath;if(c.debug&&console.log("router> routing "+f),d.equal(f,e)){var g=a.grep(b.RoutingState.Templates(),function(a){return""===a.UrlPattern()});return void(g.length>0&&b.$router.routeTo("",g[0]))}if(e+="/",d.startsWith(f,e)){var h=null,g=a.grep(b.$element.find("[data-vm-route]"),function(b){return d.startsWith(f,a(b).attr("href"))});if(g.length>0)for(i=0;i<g.length;i++)(null==h||a(h).attr("href").length<a(g[i]).attr("href").length)&&(h=g[i]);if(null!=h){var j=a(h).attr("data-vm-route"),k=b.$router.hasOwnProperty("pathToRoute")&&b.$router.pathToRoute.hasOwnProperty(j)?b.$router.pathToRoute[j].$template:null;if(null!=k)return d.equal(c.router.urlPath,b.$router.toUrl(j))&&(c.router.urlPath=""),d.equal(b.RoutingState.Active(),j)||b.$router.routeTo(j,k),!0}else if(c.router.match(f))return c.router.urlPath="",!0}return!1}.bind(b),toUrl:function(a){var b=d.trim(a);return"("!=b.charAt(0)&&""!=b&&(b="/"+b),this.hasOwnProperty("RoutingState")&&("function"===this.RoutingState.Root,!0)?this.RoutingState.Root()+b:a}.bind(b)}}(b)},c.plugins.router=c.router,b.bindingHandlers.vmRoute={update:function(d,e,f,g,h){var j=h.$root,k=b.unwrap(e());if(!k.hasOwnProperty("Path")||!k.hasOwnProperty("TemplateId"))throw new Error("invalid vmRoute data at "+d.outerHTML);j.$router.initRoot(),path=k.Path();var l=null;if(j.hasOwnProperty("RoutingState")&&"function"==typeof j.RoutingState.Templates&&null!=j.RoutingState.Templates()){var m=a.grep(j.RoutingState.Templates(),function(a){return a.Id()==k.TemplateId()});if(m.length>0)l=m[0],null==path&&(path=l.UrlPattern(),k.Path(path));else if(null==k.RedirectRoot())throw new Error("vmRoute cannot find route template '"+k.TemplateId()+"' at "+d.outerHTML)}if(null!=k.RedirectRoot()){var n=k.RedirectRoot();"/"==n.charAt(0)&&(n=n.substr(0,n.length-1));var o=k.RedirectRoot().split("/"),p="",q=j.$element.attr("data-vm-root");if(null!=q){var r=q.split("/");for(i=0;i<r.length&&(""==r[i]||r[i]!=o[0]);i++)p+=r[i]+"/"}return p+=n+"/"+path,void a(d).attr("href",p).attr("data-vm-route",path).click(function(b){b.preventDefault(),c.router.pushState({},"",a(this).attr("href"))})}if(null==l)throw new Error("vmRoute cannot find any route template at "+d.outerHTML);k.$template=l,j.$router.pathToRoute=j.$router.pathToRoute||{},j.$router.pathToRoute[path]=k,a(d).attr("href",j.$router.toUrl(path)).attr("data-vm-route",path).click(function(b){b.preventDefault(),c.router.pushState({},"",a(this).attr("href"))})}}});